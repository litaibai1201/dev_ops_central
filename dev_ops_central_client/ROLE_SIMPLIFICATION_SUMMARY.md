# è§’è‰²ç³»ç»Ÿç®€åŒ–ä¿®æ”¹æ€»ç»“

## ä¿®æ”¹æ¦‚è¿°

æ ¹æ®éœ€æ±‚ï¼Œä»ç³»ç»Ÿä¸­ç§»é™¤äº† `group_owner` å’Œ `project_admin` ä¸¤ä¸ªè§’è‰²ï¼Œç®€åŒ–è§’è‰²ä½“ç³»ä¸ºåªæœ‰ä¸¤ä¸ªä¸»ä½“è§’è‰²ï¼š
- `user` - æ™®é€šç”¨æˆ·
- `system_admin` - ç³»ç»Ÿç®¡ç†å‘˜

## ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

### 1. ç±»å‹å®šä¹‰ (`src/types/index.ts`)
**ä¿®æ”¹å†…å®¹ï¼š**
```typescript
// ä¿®æ”¹å‰
role: 'user' | 'admin' | 'group_owner' | 'project_admin' | 'system_admin';

// ä¿®æ”¹å  
role: 'user' | 'system_admin';
```

**å½±å“ï¼š**
- ç»Ÿä¸€äº†ç”¨æˆ·è§’è‰²ç±»å‹å®šä¹‰
- ç§»é™¤äº† `admin`ã€`group_owner`ã€`project_admin` ä¸‰ä¸ªè§’è‰²
- ä¿ç•™ `user` å’Œ `system_admin` ä½œä¸ºä¸»ä½“è§’è‰²

### 2. ç™»å½•é¡µé¢ (`src/pages/auth/AuthPage.tsx`)

#### ç™»å½•é€»è¾‘ç®€åŒ–
**ä¿®æ”¹å†…å®¹ï¼š**
```typescript
// ä¿®æ”¹å‰
role: values.username === 'admin' ? 'system_admin' : 
      values.username === 'groupowner' ? 'group_owner' :
      values.username === 'projectadmin' ? 'project_admin' : 'user'

// ä¿®æ”¹å
role: values.username === 'admin' ? 'system_admin' : 'user'
```

#### æµ‹è¯•è´¦å·è¯´æ˜æ›´æ–°
**ä¿®æ”¹å†…å®¹ï¼š**
```html
<!-- ä¿®æ”¹å‰ -->
<p>ç®¡ç†å‘˜: admin / ç¾¤ä¸»: groupowner</p>
<p>ä¸“æ¡ˆç®¡ç†å‘˜: projectadmin / æ™®é€šç”¨æˆ·: user</p>

<!-- ä¿®æ”¹å -->
<p>ç®¡ç†å‘˜: admin / æ™®é€šç”¨æˆ·: user</p>
```

**å½±å“ï¼š**
- ç®€åŒ–äº†ç™»å½•æµ‹è¯•é€»è¾‘
- åªä¿ç•™ `admin` å’Œ `user` ä¸¤ä¸ªæµ‹è¯•è´¦å·
- æ¸…ç†äº†é¡µé¢ä¸Šçš„è§’è‰²è¯´æ˜æ–‡æœ¬

### 3. ä¸»å¸ƒå±€ (`src/components/layout/MainLayout.tsx`)

#### è§’è‰²æ˜¾ç¤ºåç§°æ˜ å°„
**ä¿®æ”¹å†…å®¹ï¼š**
```typescript
// ä¿®æ”¹å‰
const roleMap = {
  user: 'æ™®é€šç”¨æˆ·',
  project_admin: 'ä¸“æ¡ˆç®¡ç†å‘˜',
  group_owner: 'ç¾¤ä¸»',  
  system_admin: 'ç³»ç»Ÿç®¡ç†å‘˜'
};

// ä¿®æ”¹å
const roleMap = {
  user: 'æ™®é€šç”¨æˆ·',
  system_admin: 'ç³»ç»Ÿç®¡ç†å‘˜'
};
```

**å½±å“ï¼š**
- å³ä¸Šè§’ç”¨æˆ·ä¸‹æ‹‰æ¡†åªæ˜¾ç¤º "æ™®é€šç”¨æˆ·" æˆ– "ç³»ç»Ÿç®¡ç†å‘˜"
- æ¸…ç†äº†æ— æ•ˆçš„è§’è‰²æ˜ å°„
- ç»Ÿä¸€äº†è§’è‰²æ˜¾ç¤ºé€»è¾‘

### 4. ä¸“æ¡ˆæ€»è§ˆé¡µé¢ (`src/pages/dashboard/DashboardPage.tsx`)

#### æ“ä½œæƒé™æ§åˆ¶
**ä¿®æ”¹å†…å®¹ï¼š**
```typescript
// ä¿®æ”¹å‰
if (user.role === 'project_admin' || user.role === 'group_owner' || user.role === 'system_admin') {
  actions.push(createEditAction(() => navigate(`/projects/${record.id}/edit`)));
}

// ä¿®æ”¹å
if (user.role === 'system_admin') {
  actions.push(createEditAction(() => navigate(`/projects/${record.id}/edit`)));
}
```

**å½±å“ï¼š**
- ä¸“æ¡ˆåˆ—è¡¨ä¸­çš„ç¼–è¾‘æ“ä½œåªæœ‰ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨
- æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹ä¸“æ¡ˆè¯¦æƒ…
- ç®€åŒ–äº†æƒé™åˆ¤æ–­é€»è¾‘

## è§’è‰²ä½“ç³»é‡æ–°è®¾è®¡

### ğŸ¯ **æ–°çš„è§’è‰²é€»è¾‘**

#### ä¸»ä½“è§’è‰²
1. **æ™®é€šç”¨æˆ· (`user`)**
   - ç³»ç»Ÿçš„åŸºç¡€è§’è‰²
   - å¯ä»¥æŸ¥çœ‹å…¬å¼€ä¸“æ¡ˆ
   - å¯ä»¥åˆ›å»ºç¾¤ç»„
   - æˆä¸ºç¾¤ä¸»åå¯ä»¥åœ¨ç¾¤ç»„ä¸­åˆ›å»ºä¸“æ¡ˆ

2. **ç³»ç»Ÿç®¡ç†å‘˜ (`system_admin`)**
   - ç³»ç»Ÿæœ€é«˜æƒé™è§’è‰²
   - å¯ä»¥ç®¡ç†æ‰€æœ‰ç”¨æˆ·å’Œç¾¤ç»„
   - å¯ä»¥ç¼–è¾‘æ‰€æœ‰ä¸“æ¡ˆ
   - å…·æœ‰ç³»ç»Ÿé…ç½®æƒé™

#### ç›¸å¯¹è§’è‰²ï¼ˆåŸºäºå…·ä½“å…³ç³»ï¼‰
1. **ç¾¤ä¸»**
   - åŸºäºå…·ä½“ç¾¤ç»„çš„ç›¸å¯¹è§’è‰²
   - é€šè¿‡ `Group.ownerId` å­—æ®µç¡®å®š
   - å¯ä»¥åœ¨å…¶ç®¡ç†çš„ç¾¤ç»„ä¸­åˆ›å»ºä¸“æ¡ˆ
   - å¯ä»¥ç®¡ç†ç¾¤ç»„æˆå‘˜å’Œæƒé™

2. **ä¸“æ¡ˆç®¡ç†å‘˜**
   - åŸºäºå…·ä½“ä¸“æ¡ˆçš„ç›¸å¯¹è§’è‰²
   - é€šè¿‡ `GroupMember.role` å’Œæƒé™å­—æ®µç¡®å®š
   - å¯ä»¥ç®¡ç†å…·ä½“ä¸“æ¡ˆçš„APIæ¥å£
   - ç”±ç¾¤ä¸»åˆ†é…å’Œç®¡ç†

### ğŸ”„ **è§’è‰²åˆ¤æ–­é€»è¾‘**

#### ç¾¤ä¸»èº«ä»½åˆ¤æ–­
```typescript
// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºæŸä¸ªç¾¤ç»„çš„ç¾¤ä¸»
const isGroupOwner = (userId: string, groupId: string) => {
  return group.ownerId === userId;
};

// è·å–ç”¨æˆ·ç®¡ç†çš„æ‰€æœ‰ç¾¤ç»„
const ownedGroups = userGroups.filter(group => group.ownerId === user.id);
```

#### ä¸“æ¡ˆç®¡ç†æƒé™åˆ¤æ–­
```typescript
// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥ç®¡ç†ä¸“æ¡ˆ
const canManageProject = (user: User, project: Project) => {
  return user.role === 'system_admin' || 
         project.group.ownerId === user.id;
};
```

### ğŸ“Š **æƒé™çŸ©é˜µ**

| æ“ä½œ | æ™®é€šç”¨æˆ· | ç¾¤ä¸»(ç›¸å¯¹) | ç³»ç»Ÿç®¡ç†å‘˜ |
|------|----------|------------|------------|
| æŸ¥çœ‹å…¬å¼€ä¸“æ¡ˆ | âœ… | âœ… | âœ… |
| åˆ›å»ºç¾¤ç»„ | âœ… | âœ… | âœ… |
| åˆ›å»ºä¸“æ¡ˆ | âŒ | âœ… (åœ¨ç®¡ç†çš„ç¾¤ç»„ä¸­) | âœ… |
| ç¼–è¾‘ä¸“æ¡ˆ | âŒ | âœ… (åœ¨ç®¡ç†çš„ç¾¤ç»„ä¸­) | âœ… |
| ç®¡ç†ç¾¤ç»„æˆå‘˜ | âŒ | âœ… (åœ¨ç®¡ç†çš„ç¾¤ç»„ä¸­) | âœ… |
| ç³»ç»Ÿç®¡ç† | âŒ | âŒ | âœ… |

### ğŸ¨ **ç”¨æˆ·ç•Œé¢å½±å“**

#### ç™»å½•é¡µé¢
- ç®€åŒ–æµ‹è¯•è´¦å·è¯´æ˜
- ç§»é™¤äº†ä¸å†ä½¿ç”¨çš„è§’è‰²æµ‹è¯•å…¥å£
- ä¿æŒç•Œé¢æ•´æ´

#### å³ä¸Šè§’ç”¨æˆ·æ˜¾ç¤º
- åªæ˜¾ç¤ºä¸¤ç§ä¸»ä½“è§’è‰²
- è§’è‰²åç§°æ›´åŠ æ¸…æ™°
- é¿å…æ··æ·†ç›¸å¯¹è§’è‰²

#### ä¸“æ¡ˆæ€»è§ˆé¡µé¢
- å¿«æ·æ“ä½œåŒºåŸŸæ ¹æ®å®é™…ç¾¤ä¸»èº«ä»½åŠ¨æ€æ˜¾ç¤º
- æƒé™è¯´æ˜æ›´åŠ å‡†ç¡®
- çªå‡ºäº†è§’è‰²çš„ç›¸å¯¹æ€§æ¦‚å¿µ

### ğŸ” **æ•°æ®å…³ç³»ä¿æŒ**

è™½ç„¶ç§»é™¤äº†è§’è‰²å¸¸é‡ï¼Œä½†ç›¸å…³çš„æ•°æ®å…³ç³»ä»ç„¶ä¿æŒï¼š
- `Group.ownerId` ç»§ç»­æ ‡è¯†ç¾¤ä¸»å…³ç³»
- `GroupMember.role` ç»§ç»­ç®¡ç†ç¾¤ç»„å†…è§’è‰²
- `GroupMember.permissions` ç»§ç»­æ§åˆ¶å…·ä½“æƒé™

### âœ… **éªŒè¯è¦ç‚¹**

1. **ç™»å½•æµ‹è¯•**
   - `admin` ç”¨æˆ·ç™»å½•åæ˜¾ç¤ºä¸º "ç³»ç»Ÿç®¡ç†å‘˜"
   - `user` ç”¨æˆ·ç™»å½•åæ˜¾ç¤ºä¸º "æ™®é€šç”¨æˆ·"
   - ç§»é™¤çš„è§’è‰²è´¦å·ä¸å†å¯ç”¨

2. **æƒé™éªŒè¯**
   - ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ç¼–è¾‘æ‰€æœ‰ä¸“æ¡ˆ
   - æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹ä¸“æ¡ˆ
   - ç¾¤ä¸»å¯ä»¥åœ¨å¿«æ·æ“ä½œåŒºåŸŸåˆ›å»ºä¸“æ¡ˆ

3. **ç•Œé¢ä¸€è‡´æ€§**
   - æ‰€æœ‰è§’è‰²æ˜¾ç¤ºç»Ÿä¸€ä½¿ç”¨æ–°çš„æ˜ å°„
   - ç§»é™¤äº†åºŸå¼ƒè§’è‰²çš„ç›¸å…³æ–‡æœ¬
   - ä¿æŒäº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

è¿™æ¬¡ä¿®æ”¹æˆåŠŸç®€åŒ–äº†è§’è‰²ç³»ç»Ÿï¼Œè®©ä¸»ä½“è§’è‰²å’Œç›¸å¯¹è§’è‰²çš„æ¦‚å¿µæ›´åŠ æ¸…æ™°ï¼ŒåŒæ—¶ä¿æŒäº†ç³»ç»Ÿçš„å®Œæ•´åŠŸèƒ½ã€‚
